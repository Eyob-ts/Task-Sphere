<h2 mat-dialog-title>{{dialogTitle}}</h2>

<mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <mat-dialog-content>
    <div *ngIf="loading; else formContent" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading projects...</p>
    </div>

    <ng-template #formContent>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Task Title</mat-label>
        <input matInput formControlName="title" required placeholder="Enter task title" title="Task Title">
        <mat-error *ngIf="form.get('title')?.hasError('required')">Title is required</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" required placeholder="Enter task description" title="Task Description"></textarea>
        <mat-error *ngIf="form.get('description')?.hasError('required')">Description is required</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Project</mat-label>
        <mat-select formControlName="projectId" required>
          <mat-option *ngFor="let project of projects" [value]="project.id">
            {{ project.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('projectId')?.hasError('required')">Project is required</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Due Date</mat-label>
        <input matInput [matDatepicker]="duePicker" formControlName="dueDate" required placeholder="Select due date" title="Task Due Date">
        <mat-datepicker-toggle matSuffix [for]="duePicker"></mat-datepicker-toggle>
        <mat-datepicker #duePicker></mat-datepicker>
        <mat-error *ngIf="form.get('dueDate')?.hasError('required')">Due date is required</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status" required>
          <mat-option *ngFor="let status of statusOptions" [value]="status">
            {{ status }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('status')?.hasError('required')">Status is required</mat-error>
      </mat-form-field>
    </ng-template>
  </mat-dialog-content>

  <mat-dialog-actions align="end" *ngIf="!loading">
    <button mat-button type="button" (click)="onCancel()">Cancel</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="!form.valid">
      {{ data?.id ? 'Update' : 'Create' }}
    </button>
  </mat-dialog-actions>
</form>
